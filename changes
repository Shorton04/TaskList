METHOD on_f4.

  DATA lt_return TYPE TABLE OF ddshretval.
  DATA ls_return TYPE ddshretval.
  DATA lr_data   TYPE REF TO data.

  CASE e_fieldname.

    WHEN 'VAGRP'.
      CALL FUNCTION 'F4IF_FIELD_VALUE_REQUEST'
        EXPORTING
          tabname   = 'PLKO'
          fieldname = 'VAGRPM'
        TABLES
          return_tab = lt_return.

    WHEN 'ARBPL_H' OR 'ARBPL_O'.
      CALL FUNCTION 'F4IF_FIELD_VALUE_REQUEST'
        EXPORTING
          tabname   = 'CRHD'
          fieldname = 'ARBPL'
        TABLES
          return_tab = lt_return.

    WHEN OTHERS.
      RETURN.

  ENDCASE.

  READ TABLE lt_return INTO ls_return INDEX 1.
  IF sy-subrc = 0.

    "-------------------------------
    " FIX: kernel-safe dereference
    "-------------------------------
    lr_data = er_event_data->m_data.
    ASSIGN lr_data->* TO FIELD-SYMBOL(<fs_value>).
    <fs_value> = ls_return-fieldval.

    er_event_data->m_event_handled = abap_true.

  ENDIF.

ENDMETHOD.






FORM get_header_wcenter CHANGING cs TYPE ty_task_base.

  "Check if field exists and is not initial
  IF line_exists( cs-arbid_h ).
    SELECT SINGLE arbpl
      INTO cs-arbpl_h
      FROM crhd
      WHERE objid = cs-arbid_h
        AND objty = 'A'.
  ENDIF.

ENDFORM.