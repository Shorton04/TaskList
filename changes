FORM set_columns_enhanced USING io_columns TYPE REF TO cl_salv_columns_table.

  DATA lo_col TYPE REF TO cl_salv_column_table.

  "--- Hide technical fields
  DATA lt_hidden TYPE STANDARD TABLE OF lvc_fname WITH EMPTY KEY.
  APPEND 'ROW_TYPE'        TO lt_hidden.
  APPEND 'PARENT_PLAN'     TO lt_hidden.
  APPEND 'ICON'            TO lt_hidden.
  APPEND 'IS_EXPANDED_OBJ' TO lt_hidden.
  APPEND 'IS_EXPANDED_TXT' TO lt_hidden.
  APPEND 'ROW_COLOR'       TO lt_hidden.
  LOOP AT lt_hidden INTO DATA(lv_hidden).
    TRY.
        lo_col ?= io_columns->get_column( lv_hidden ).
        lo_col->set_technical( abap_true ).
        lo_col->set_visible( abap_false ).
      CATCH cx_salv_not_found.
    ENDTRY.
  ENDLOOP.

  "===============================================================
  "  DISPLAY MODE HANDLING
  "===============================================================

  "###############################################################
  "  MODE 1: Show Char = NO | Show LT = NO
  "###############################################################
  IF gv_show_char = abap_false AND gv_show_ltxt = abap_false.

    "--- hide char columns
    PERFORM hide_cols USING io_columns 'MERKNR' 'VERWMERKM' 'KURZTEXT'
                                 'LTEXTKZ' 'TOLERANZUN' 'TOLERANZOB'
                                 'METHODE' 'STICHPRVER'
                                 'CHAR_LONGTEXT' 'CHAR_FK'.

    "--- hide operation long text
    PERFORM hide_cols USING io_columns 'OP_LONGTEXT' 'OP_FK'.

    "--- ensure insp#, description visible
    PERFORM show_cols USING io_columns 'INSP_POINT' 'DESCRIPTION' 'INSP_METHOD'.

  ENDIF.


  "###############################################################
  "  MODE 2: Show Char = YES | Show LT = NO
  "###############################################################
  IF gv_show_char = abap_true AND gv_show_ltxt = abap_false.

    "--- char columns visible
    PERFORM show_cols USING io_columns 'MERKNR' 'VERWMERKM' 'KURZTEXT'
                                 'LTEXTKZ' 'TOLERANZUN' 'TOLERANZOB'
                                 'METHODE' 'STICHPRVER'.

    "--- hide op-long text
    PERFORM hide_cols USING io_columns 'OP_LONGTEXT' 'OP_FK'.

    "--- hide char-long text
    PERFORM hide_cols USING io_columns 'CHAR_LONGTEXT' 'CHAR_FK'.

    "--- insp#, desc visible
    PERFORM show_cols USING io_columns 'INSP_POINT' 'DESCRIPTION' 'INSP_METHOD'.

  ENDIF.


  "###############################################################
  "  MODE 3: Show Char = NO | Show LT = YES
  "###############################################################
  IF gv_show_char = abap_false AND gv_show_ltxt = abap_true.

    "--- show op long text
    PERFORM show_cols USING io_columns 'OP_LONGTEXT' 'OP_FK'.

    "--- hide all characteristics columns
    PERFORM hide_cols USING io_columns 'MERKNR' 'VERWMERKM' 'KURZTEXT'
                                 'LTEXTKZ' 'TOLERANZUN' 'TOLERANZOB'
                                 'METHODE' 'STICHPRVER'
                                 'CHAR_LONGTEXT' 'CHAR_FK'.

    "--- insp#, desc must be BLANK (FDS)
    PERFORM blank_columns USING 'INSP_POINT' 'DESCRIPTION' 'INSP_METHOD'.

  ENDIF.


  "###############################################################
  "  MODE 4: Show Char = YES | Show LT = YES
  "###############################################################
  IF gv_show_char = abap_true AND gv_show_ltxt = abap_true.

    "--- hide op long text (FDS)
    PERFORM hide_cols USING io_columns 'OP_LONGTEXT' 'OP_FK'.

    "--- char columns visible
    PERFORM show_cols USING io_columns 'MERKNR' 'VERWMERKM' 'KURZTEXT'
                                 'LTEXTKZ' 'TOLERANZUN' 'TOLERANZOB'
                                 'METHODE' 'STICHPRVER'.

    "--- show char long text
    PERFORM show_cols USING io_columns 'CHAR_LONGTEXT' 'CHAR_FK'.

    "--- insp# and description visible
    PERFORM show_cols USING io_columns 'INSP_POINT' 'DESCRIPTION' 'INSP_METHOD'.

  ENDIF.

ENDFORM.






FORM hide_cols USING io_columns TYPE REF TO cl_salv_columns_table
                      col1 col2 col3 col4 col5 col6 col7 col8 col9 col10.

  DATA lo TYPE REF TO cl_salv_column_table.
  DATA cols TYPE STANDARD TABLE OF string.

  APPEND col1 TO cols. APPEND col2 TO cols. APPEND col3 TO cols.
  APPEND col4 TO cols. APPEND col5 TO cols. APPEND col6 TO cols.
  APPEND col7 TO cols. APPEND col8 TO cols. APPEND col9 TO cols.
  APPEND col10 TO cols.

  LOOP AT cols INTO DATA(c).
    TRY.
        lo ?= io_columns->get_column( c ).
        lo->set_visible( abap_false ).
      CATCH cx_salv_not_found.
    ENDTRY.
  ENDLOOP.

ENDFORM.


FORM show_cols USING io_columns TYPE REF TO cl_salv_columns_table
                       col1 col2 col3 col4 col5 col6 col7 col8 col9 col10.

  DATA lo TYPE REF TO cl_salv_column_table.
  DATA cols TYPE STANDARD TABLE OF string.

  APPEND col1 TO cols. APPEND col2 TO cols. APPEND col3 TO cols.
  APPEND col4 TO cols. APPEND col5 TO cols. APPEND col6 TO cols.
  APPEND col7 TO cols. APPEND col8 TO cols. APPEND col9 TO cols.
  APPEND col10 TO cols.

  LOOP AT cols INTO DATA(c).
    TRY.
        lo ?= io_columns->get_column( c ).
        lo->set_visible( abap_true ).
      CATCH cx_salv_not_found.
    ENDTRY.
  ENDLOOP.

ENDFORM.



FORM blank_columns USING col1 col2 col3.

  LOOP AT gt_display ASSIGNING FIELD-SYMBOL(<r>).
    ASSIGN COMPONENT col1 OF STRUCTURE <r> TO FIELD-SYMBOL(<a1>).
    IF <a1> IS ASSIGNED. CLEAR <a1>. ENDIF.

    ASSIGN COMPONENT col2 OF STRUCTURE <r> TO FIELD-SYMBOL(<a2>).
    IF <a2> IS ASSIGNED. CLEAR <a2>. ENDIF.

    ASSIGN COMPONENT col3 OF STRUCTURE <r> TO FIELD-SYMBOL(<a3>).
    IF <a3> IS ASSIGNED. CLEAR <a3>. ENDIF.
  ENDLOOP.

ENDFORM.





a