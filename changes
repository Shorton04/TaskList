*---------------------------------------------------------------------*
* Display ALV with SALV and two custom buttons
*---------------------------------------------------------------------*
FORM display_alv.

  DATA: lx_salv_msg TYPE REF TO cx_salv_msg,
        lx_salv_ex  TYPE REF TO cx_root,
        lv_title    TYPE lvc_title.

  "No data – nothing to show
  IF gt_display IS INITIAL.
    MESSAGE s398(00) WITH 'No data to display'.
    RETURN.
  ENDIF.

  TRY.

      "---------------------------------------------------------------*
      " Create SALV
      "---------------------------------------------------------------*
      CALL METHOD cl_salv_table=>factory
        IMPORTING
          r_salv_table = lo_alv
        CHANGING
          t_table      = gt_display.

      "---------------------------------------------------------------*
      " Columns
      "---------------------------------------------------------------*
      lo_columns = lo_alv->get_columns( ).
      CALL METHOD lo_columns->set_optimize
        EXPORTING
          value = abap_true.

      "Hide technical columns
      TRY.
          lo_column = lo_columns->get_column( 'ROW_KIND' ).
          lo_column->set_technical( abap_true ).
        CATCH cx_salv_not_found.
      ENDTRY.

      TRY.
          lo_column = lo_columns->get_column( 'TDFORMAT' ).
          lo_column->set_technical( abap_true ).
        CATCH cx_salv_not_found.
      ENDTRY.

      "Long-text column header
      TRY.
          lo_column = lo_columns->get_column( 'TDLINE' ).
          lo_column->set_long_text( 'Long Text' ).
          lo_column->set_medium_text( 'Long Text' ).
          lo_column->set_short_text( 'LongTxt' ).
        CATCH cx_salv_not_found.
      ENDTRY.

      "---------------------------------------------------------------*
      " Display settings
      "---------------------------------------------------------------*
      lo_disp = lo_alv->get_display_settings( ).
      CALL METHOD lo_disp->set_striped_pattern
        EXPORTING
          value = abap_true.

      lv_title = 'Valid Task Lists'.
      lo_disp->set_list_header( lv_title ).

      "---------------------------------------------------------------*
      " Layout
      "---------------------------------------------------------------*
      lo_layout = lo_alv->get_layout( ).
      ls_layout_key-report = sy-repid.
      CALL METHOD lo_layout->set_key
        EXPORTING
          value = ls_layout_key.
      CALL METHOD lo_layout->set_save_restriction
        EXPORTING
          value = if_salv_c_layout=>restrict_none.
      lo_layout->set_default( abap_true ).

      "---------------------------------------------------------------*
      " Standard functions + custom buttons
      "---------------------------------------------------------------*
      lo_funcs = lo_alv->get_functions( ).
      CALL METHOD lo_funcs->set_all
        EXPORTING
          value = abap_true.

      "Custom button – Characteristics
      CALL METHOD lo_funcs->add_function
        EXPORTING
          name     = gc_func_char      " 'ZCHAR'
          text     = 'Characteristics'
          tooltip  = 'Show / Hide characteristics'
          position = if_salv_c_function_position=>right_of_salv_functions.

      "Custom button – Long text
      CALL METHOD lo_funcs->add_function
        EXPORTING
          name     = gc_func_ltxt      " 'ZLTXT'
          text     = 'Long Text'
          tooltip  = 'Show / Hide long text'
          position = if_salv_c_function_position=>right_of_salv_functions.

      "---------------------------------------------------------------*
      " Selections
      "---------------------------------------------------------------*
      lo_sel = lo_alv->get_selections( ).
      lo_sel->set_selection_mode( if_salv_c_selection_mode=>row_column ).

      "---------------------------------------------------------------*
      " Events – handled in local class LCL_EVENT_HANDLER
      "---------------------------------------------------------------*
      lo_events = lo_alv->get_event( ).
      SET HANDLER lcl_event_handler=>on_user_command FOR lo_events.

      "---------------------------------------------------------------*
      " Display ALV
      "---------------------------------------------------------------*
      lo_alv->display( ).

    CATCH cx_salv_existing INTO lx_salv_ex.
      MESSAGE lx_salv_ex->get_text( ) TYPE 'E'.

    CATCH cx_salv_wrong_call INTO lx_salv_ex.
      MESSAGE lx_salv_ex->get_text( ) TYPE 'E'.

    CATCH cx_salv_msg INTO lx_salv_msg.
      MESSAGE lx_salv_msg->get_text( ) TYPE 'E'.

  ENDTRY.

ENDFORM.