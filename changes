*&---------------------------------------------------------------------*
*& Form SET_COLUMN_VISIBILITY_BY_STATE
*&---------------------------------------------------------------------*
FORM set_column_visibility_by_state.

  DATA: lo_cols TYPE REF TO cl_salv_columns_table,
        lo_col  TYPE REF TO cl_salv_column.

  lo_cols = go_alv->get_columns( ).

  "============ MACROS =======================
  "Safe hide
  DEFINE hidec.
    TRY.
        lo_col ?= lo_cols->get_column( &1 ).
        lo_col->set_visible( if_salv_c_bool_sap=>false ).
      CATCH cx_salv_not_found.
    ENDTRY.
  END-OF-DEFINITION.

  "Safe show
  DEFINE showc.
    TRY.
        lo_col ?= lo_cols->get_column( &1 ).
        lo_col->set_visible( if_salv_c_bool_sap=>true ).
      CATCH cx_salv_not_found.
    ENDTRY.
  END-OF-DEFINITION.

  "Safe positioning (working SALV API)
  DEFINE set_pos.
    TRY.
        lo_cols->set_column_position(
           columnname = &1
           position   = &2
        ).
      CATCH cx_salv_not_found.
    ENDTRY.
  END-OF-DEFINITION.
  "===========================================


  "==== Default show these always ====
  showc 'PLNNR'.
  showc 'PLNAL'.
  showc 'WERKS'.
  showc 'VORNR'.
  showc 'ARBPL'.
  showc 'STEUS'.
  showc 'LTXA1'.
  showc 'PLMK~MERKNR'.
  showc 'PLMK~KURZTEXT'.
  showc 'PLMK~VERWMERKMAL'.
  showc 'PLMK~VERSION'.
  showc 'PLMK~PLMKZ'.
  showc 'PLMK~MERKTY'.
  showc 'INSPECTION_METHOD'.
  showc 'INSPECTION_NUMBER'.

  "Hide both long-text columns first
  hidec 'OP_LTXT'.
  hidec 'CHAR_LTXT'.
  hidec 'FK'.

  "==================================================
  " MODE A = No Char, No LT
  "==================================================
  IF gv_show_char = gc_false AND gv_show_ltxt = gc_false.

    hidec 'FK'.
    hidec 'OP_LTXT'.
    hidec 'CHAR_LTXT'.

    "Normal layout
    set_pos 'LTXA1' 6.
    set_pos 'INSPECTION_METHOD' 7.
    set_pos 'INSPECTION_NUMBER' 8.

  "==================================================
  " MODE B = Show Char, No LT
  "==================================================
  ELSEIF gv_show_char = gc_true AND gv_show_ltxt = gc_false.

    showc 'FK'.
    showc 'PLMK~MERKNR'.

    hidec 'OP_LTXT'.
    hidec 'CHAR_LTXT'.

    set_pos 'INSPECTION_METHOD' 7.
    set_pos 'INSPECTION_NUMBER' 8.
    set_pos 'FK' 9.
    set_pos 'PLMK~MERKNR' 10.

  "==================================================
  " MODE C = No Char, Show LT
  "==================================================
  ELSEIF gv_show_char = gc_false AND gv_show_ltxt = gc_true.

    showc 'OP_LTXT'.
    showc 'FK'.

    hidec 'CHAR_LTXT'.
    hidec 'PLMK~MERKNR'.

    "Place FK + OP_LONG after operation
    set_pos 'FK' 6.
    set_pos 'OP_LTXT' 7.

  "==================================================
  " MODE D = Show Char, Show LT
  "==================================================
  ELSEIF gv_show_char = gc_true AND gv_show_ltxt = gc_true.

    showc 'FK'.
    showc 'CHAR_LTXT'.

    hidec 'OP_LTXT'.   "Only char LT in this mode

    "Place FK + Char LT at end (after insp meth & insp#)
    set_pos 'INSPECTION_METHOD' 7.
    set_pos 'INSPECTION_NUMBER' 8.
    set_pos 'FK' 9.
    set_pos 'CHAR_LTXT' 10.

  ENDIF.

ENDFORM.