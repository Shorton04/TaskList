FORM append_op_longtext USING is_base TYPE ty_task_base.

  DATA: lt_lines TYPE TABLE OF tline,
        ls_line  TYPE tline,
        lv_name  TYPE thead-tdname.

  CLEAR lt_lines.

  "Build NAME according to FDS
  lv_name = |{ sy-mandt }{
              is_base-plnty }{
              is_base-plnnr ALPHA = OUT }{
              is_base-plnkn ALPHA = OUT }{
              is_base-zaehl ALPHA = OUT }|.

  CALL FUNCTION 'READ_TEXT'
    EXPORTING
      id       = 'PLPO'
      language = sy-langu
      name     = lv_name
      object   = 'ROUTING'
    TABLES
      lines    = lt_lines
    EXCEPTIONS
      OTHERS   = 4.

  IF sy-subrc <> 0 OR lt_lines IS INITIAL.
    RETURN.
  ENDIF.

  LOOP AT lt_lines INTO ls_line.
    CLEAR gs_display.
    MOVE-CORRESPONDING is_base TO gs_display.

    gs_display-row_kind  = 'L'.
    gs_display-op_ltxt   = ls_line-tdline.
    gs_display-tdformat  = ls_line-tdformat.

    APPEND gs_display TO gt_display.
  ENDLOOP.

ENDFORM.





FORM append_char_longtext USING is_base TYPE ty_task_base.

  DATA: lt_lines TYPE TABLE OF tline,
        ls_line  TYPE tline,
        lv_name  TYPE thead-tdname.

  CLEAR lt_lines.

  "Build NAME per FDS: mandt + plnty + plnnr + plnkn + merknr
  lv_name = |{ sy-mandt }{
              is_base-plnty }{
              is_base-plnnr ALPHA = OUT }{
              is_base-plnkn ALPHA = OUT }{
              is_base-merknr ALPHA = OUT }|.

  CALL FUNCTION 'READ_TEXT'
    EXPORTING
      id       = 'QM'
      language = sy-langu
      name     = lv_name
      object   = 'QSS'
    TABLES
      lines    = lt_lines
    EXCEPTIONS
      OTHERS   = 4.

  IF sy-subrc <> 0 OR lt_lines IS INITIAL.
    RETURN.
  ENDIF.

  LOOP AT lt_lines INTO ls_line.
    CLEAR gs_display.
    MOVE-CORRESPONDING is_base TO gs_display.

    gs_display-row_kind   = 'L'.
    gs_display-char_ltxt  = ls_line-tdline.
    gs_display-tdformat   = ls_line-tdformat.

    APPEND gs_display TO gt_display.
  ENDLOOP.

ENDFORM.