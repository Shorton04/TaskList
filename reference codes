FORM append_op_longtext USING is_base TYPE ty_task_base.

  DATA: lt_lines  TYPE STANDARD TABLE OF tline,
        ls_line   TYPE tline,
        lv_name   TYPE thead-tdname,
        lv_indent TYPE string,
        ls_color  TYPE lvc_s_scol,
        ls_disp   TYPE ty_task_disp.


  CLEAR: lt_lines, lv_name.

  CONCATENATE sy-mandt
              is_base-plnty
              is_base-plnnr
              is_base-plnkn
              is_base-zaehl
         INTO lv_name.

  CALL FUNCTION 'READ_TEXT'
    EXPORTING
      client   = sy-mandt
      id       = 'PLPO'
      language = sy-langu
      name     = lv_name
      object   = 'ROUTING'
    TABLES
      lines    = lt_lines
    EXCEPTIONS
      OTHERS   = 4.

  IF sy-subrc <> 0 OR lt_lines IS INITIAL.
    RETURN.
  ENDIF.

  LOOP AT lt_lines INTO ls_line.

    gs_display-row_kind = 'L'.

    CLEAR gs_display.
    MOVE-CORRESPONDING is_base TO gs_display.
    CLEAR: ls_disp-merknr,
       ls_disp-kurzt_char,
       ls_disp-pmethode,
       ls_disp-verwmerkm,
       ls_disp-toleranzun,
       ls_disp-toleranzob,
       ls_disp-pruefeinh,
       ls_disp-stichprver,
       ls_disp-katalgart1,
       ls_disp-auswmenge1,
       ls_disp-steuerkz,
       ls_disp-ltextkz,
       ls_disp-char_ltxt,
       ls_disp-tdformat.

    DO 28 TIMES.
      ASSIGN COMPONENT |CI{ sy-index WIDTH = '02' }| OF STRUCTURE ls_disp TO FIELD-SYMBOL(<ci_lt_raw>).
      ASSIGN COMPONENT |CI{ sy-index WIDTH = '02' }_TXT| OF STRUCTURE ls_disp TO FIELD-SYMBOL(<ci_lt_txt>).

      IF <ci_lt_raw> IS ASSIGNED. CLEAR <ci_lt_raw>. ENDIF.
      IF <ci_lt_txt> IS ASSIGNED. CLEAR <ci_lt_txt>. ENDIF.
    ENDDO.

    gs_display-op_ltxt  = ls_line-tdline.
    gs_display-tdformat = ls_line-tdformat.

    CONCATENATE lv_indent gs_display-op_ltxt INTO gs_display-op_ltxt.

    "GREEN color
    CLEAR ls_color.
    ls_color-color-col = 1.
    APPEND ls_color TO gs_display-line_color.

    APPEND gs_display TO gt_display.

  ENDLOOP.

ENDFORM.
