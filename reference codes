MODULE status_0100 OUTPUT.

  " Rebuild display data before ALV creation/refresh
  PERFORM build_display.

  " Create ALV container only once
  IF go_container IS INITIAL.

    CREATE OBJECT go_container
      EXPORTING
        container_name = 'CC_ALV'.

    cl_salv_table=>factory(
      EXPORTING r_container  = go_container
      IMPORTING r_salv_table = lo_alv
      CHANGING  t_table      = gt_display ).

    " ALV NOW EXISTS → APPLY SELECTION SCREEN TOGGLES
    PERFORM set_column_visibility_by_state.
    PERFORM apply_column_order.
    PERFORM set_ci_headers.

    lo_alv->display( ).

  ELSE.

    " ALV already exists → apply visibility and refresh
    PERFORM set_column_visibility_by_state.
    PERFORM apply_column_order.

    lo_alv->refresh( ).

  ENDIF.

ENDMODULE.