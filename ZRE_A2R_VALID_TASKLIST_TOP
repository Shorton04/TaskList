TABLES: plko, plpo, plmk, tapl, eapl, crhd.

*======================================================================*
* TYPES – BASE DATA (Header + Operation + Characteristic)
*======================================================================*
" --- KEEP YOUR FULL TYPES EXACTLY AS IS (ty_task_base + ty_task_disp) ---
" I am not repeating them here. Do not change anything inside TYPES.

" --- END OF TYPES SECTION ---

*======================================================================*
* DATA – INTERNAL TABLES AND GLOBAL REFERENCES
*======================================================================*
DATA: gt_base       TYPE STANDARD TABLE OF ty_task_base,
      gs_base       TYPE ty_task_base,
      gt_display    TYPE STANDARD TABLE OF ty_task_disp,
      gs_display    TYPE ty_task_disp.

DATA: gt_tline TYPE STANDARD TABLE OF tline,
      gs_tline TYPE tline.

*======================================================================*
* SALV OBJECTS
*======================================================================*
DATA: lo_alv        TYPE REF TO cl_salv_table,
      lo_columns    TYPE REF TO cl_salv_columns_table,
      lo_column     TYPE REF TO cl_salv_column_table,
      lo_events     TYPE REF TO cl_salv_events_table,
      lo_funcs      TYPE REF TO cl_salv_functions_list,
      lo_layout     TYPE REF TO cl_salv_layout,
      lo_disp       TYPE REF TO cl_salv_display_settings,
      lo_sel        TYPE REF TO cl_salv_selections,
      ls_layout_key TYPE salv_s_layout_key.

*======================================================================*
* GLOBAL STATE (CHARACTERISTICS / LONG TEXT TOGGLE)
*======================================================================*
DATA: gv_show_char TYPE abap_bool,
      gv_show_ltxt TYPE abap_bool.

CONSTANTS: gc_true  TYPE abap_bool VALUE abap_true,
           gc_false TYPE abap_bool VALUE abap_false.

*======================================================================*
* SALV CUSTOM FUNCTION CODES (CLISTS instead of OLISTS)
*======================================================================*
CONSTANTS:
  gc_func_clist_s TYPE salv_de_function VALUE '&CLISTS', "Show Characteristics
  gc_func_clist_h TYPE salv_de_function VALUE '&CLISTH', "Hide Characteristics
  gc_func_ltxt_s  TYPE salv_de_function VALUE '&LTXTS',  "Show Long Text
  gc_func_ltxt_h  TYPE salv_de_function VALUE '&LTXTH'.  "Hide Long Text

*======================================================================*
* EVENT HANDLER CLASS (STATIC METHOD STYLE, LIKE MAINTPLAN)
*======================================================================*
CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
    CLASS-METHODS on_user_command
      FOR EVENT added_function OF cl_salv_events_table
      IMPORTING e_salv_function.
ENDCLASS.