*&---------------------------------------------------------------------*
*& Include ZRE_A2R_VALID_TASKLIST_TOP
*&---------------------------------------------------------------------*

TABLES: plko, plpo, plmk, tapl, eapl, crhd.

*---------------------------------------------------------------*
* Types                                                        *
*---------------------------------------------------------------*

"--- Basic “key” structure for Task List rows (header + op + char)
TYPES: BEGIN OF ty_task_raw,
         " Header level
         plnty TYPE plko-plnty,   " Task list type
         plnnr TYPE plko-plnnr,   " Group
         plnal TYPE plko-plnal,   " Group counter
         tplnr TYPE tapl-tplnr,   " Functional location
         equnr TYPE eapl-equnr,   " Equipment
         ktext TYPE plko-ktext,   " Header text
         werks TYPE plko-werks,   " Planning plant
         arbpl_h TYPE crhd-arbpl, " Work center (header)
         vagrp TYPE plko-vagrp,   " Planner group
         verwe TYPE plko-verwe,   " Usage
         statu TYPE plko-statu,   " Status
         anlzu_h TYPE plko-anlzu, " System condition (header)
         strat TYPE plko-strat,   " Maintenance strategy
         istru_h TYPE plko-istru, " Assembly (header)
         adpsp TYPE plko-adpsp,   " Ref. element PM/PS
         slwbez TYPE plko-slwbez, " Inspection points
         andat TYPE plko-andat,
         annam TYPE plko-annam,
         aedat TYPE plko-aedat,
         aenam TYPE plko-aenam,

         " Operation level
         vornr TYPE plpo-vornr,
         ltxa1 TYPE plpo-ltxa1,
         steus TYPE plpo-steus,
         arbpl_o TYPE crhd-arbpl, " Work center (operation)
         ktsch TYPE plpo-ktsch,
         arbei TYPE plpo-arbei,
         arbeh TYPE plpo-arbeh,
         dauno TYPE plpo-dauno,
         daune TYPE plpo-daune,
         kalid TYPE plpo-kalid,
         execution_stage TYPE plpo-execution_stage,
         anlzu_o TYPE plpo-anlzu,
         istru_o TYPE plpo-istru,
         larnt TYPE plpo-larnt,
         ebeln TYPE plpo-ebeln,
         ebelp TYPE plpo-ebelp,
         lifnr TYPE plpo-lifnr,
         preis TYPE plpo-preis,
         waers TYPE plpo-waers,
         sakto TYPE plpo-sakto,
         ekorg TYPE plpo-ekorg,
         ekgrp TYPE plpo-ekgrp,

         " Characteristic level
         merknr      TYPE plmk-merknr,
         verwmerkm   TYPE plmk-verwmerkm,
         kurzt_char  TYPE plmk-kurztext,
         ltextkz     TYPE plmk-ltextkz,
         steuerkz    TYPE plmk-steuerkz,
         tolun       TYPE plmk-toleranzun,
         tolob       TYPE plmk-toleranzob,
         meth        TYPE plmk-methode,
         stichprver  TYPE plmk-stichprver,
         pruefeinh   TYPE plmk-pruefeinh,
         katalogart1 TYPE plmk-katalogart1,
         auswmnge1   TYPE plmk-auswmnge1,

         " (Optionally you can pre-derive some CI fields here too…)
       END OF ty_task_raw.

"--- Display row (one line in ALV)
TYPES: BEGIN OF ty_task_disp,
         " Core data (copied from ty_task_raw)
         plnty TYPE plko-plnty,
         plnnr TYPE plko-plnnr,
         plnal TYPE plko-plnal,
         tplnr TYPE tapl-tplnr,
         equnr TYPE eapl-equnr,
         ktext TYPE plko-ktext,
         werks TYPE plko-werks,
         arbpl_h TYPE crhd-arbpl,
         vagrp TYPE plko-vagrp,
         verwe TYPE plko-verwe,
         statu TYPE plko-statu,
         anlzu_h TYPE plko-anlzu,
         strat TYPE plko-strat,
         istru_h TYPE plko-istru,
         adpsp TYPE plko-adpsp,
         slwbez TYPE plko-slwbez,
         andat TYPE plko-andat,
         annam TYPE plko-annam,
         aedat TYPE plko-aedat,
         aenam TYPE plko-aenam,

         vornr TYPE plpo-vornr,
         ltxa1 TYPE plpo-ltxa1,
         steus TYPE plpo-steus,
         arbpl_o TYPE crhd-arbpl,
         ktsch TYPE plpo-ktsch,
         arbei TYPE plpo-arbei,
         arbeh TYPE plpo-arbeh,
         dauno TYPE plpo-dauno,
         daune TYPE plpo-daune,
         kalid TYPE plpo-kalid,
         execution_stage TYPE plpo-execution_stage,
         anlzu_o TYPE plpo-anlzu,
         istru_o TYPE plpo-istru,
         larnt TYPE plpo-larnt,
         ebeln TYPE plpo-ebeln,
         ebelp TYPE plpo-ebelp,
         lifnr TYPE plpo-lifnr,
         preis TYPE plpo-preis,
         waers TYPE plpo-waers,
         sakto TYPE plpo-sakto,
         ekorg TYPE plpo-ekorg,
         ekgrp TYPE plpo-ekgrp,

         merknr      TYPE plmk-merknr,
         verwmerkm   TYPE plmk-verwmerkm,
         kurzt_char  TYPE plmk-kurztext,
         ltextkz     TYPE plmk-ltextkz,
         tolun       TYPE plmk-toleranzun,
         tolob       TYPE plmk-toleranzob,
         meth        TYPE plmk-methode,
         stichprver  TYPE plmk-stichprver,
         pruefeinh   TYPE plmk-pruefeinh,
         katalogart1 TYPE plmk-katalogart1,
         auswmnge1   TYPE plmk-auswmnge1,

         " CI/Control Indicator-derived flags – example placeholders
         ci_quant          TYPE char1,
         ci_upper_limit    TYPE char1,
         ci_lower_limit    TYPE char1,
         ci_fixed_scope    TYPE char1,

         " Long text display
         row_kind     TYPE char1,      " 'O' = op, 'C' = char, 'L' = long text
         tdformat     TYPE tline-tdformat,
         tdline       TYPE tline-tdline,
       END OF ty_task_disp.

*---------------------------------------------------------------*
* Internal tables & Work areas                                 *
*---------------------------------------------------------------*
DATA: gt_task_raw  TYPE STANDARD TABLE OF ty_task_raw,
      gs_task_raw  TYPE ty_task_raw,

      gt_display   TYPE STANDARD TABLE OF ty_task_disp,
      gs_display   TYPE ty_task_disp.

" Operation long texts
DATA: gt_op_ltxt   TYPE STANDARD TABLE OF tline,
      gt_char_ltxt TYPE STANDARD TABLE OF tline.

*---------------------------------------------------------------*
* SALV objects                                                  *
*---------------------------------------------------------------*
DATA: lo_alv        TYPE REF TO cl_salv_table,
      lo_columns    TYPE REF TO cl_salv_columns_table,
      lo_column     TYPE REF TO cl_salv_column_table,
      lo_functions  TYPE REF TO cl_salv_functions_list,
      lo_events     TYPE REF TO cl_salv_events_table,
      lo_layout     TYPE REF TO cl_salv_layout,
      lo_display    TYPE REF TO cl_salv_display_settings,
      lo_selections TYPE REF TO cl_salv_selections,
      ls_layout_key TYPE salv_s_layout_key.

*---------------------------------------------------------------*
* Toggles / State                                               *
*---------------------------------------------------------------*
DATA: gv_show_char  TYPE abap_bool,   " Show characteristics
      gv_show_ltxt  TYPE abap_bool.   " Show long text

*---------------------------------------------------------------*
* Constants                                                     *
*---------------------------------------------------------------*
CONSTANTS:
  gc_x      TYPE c LENGTH 1 VALUE 'X',

  " SALV added function codes
  gc_func_char TYPE salv_de_function VALUE 'ZCHAR',   " Show/Hide Characteristics
  gc_func_ltxt TYPE salv_de_function VALUE 'ZLTXT'.   " Show/Hide Long Text

" Optional title constants
CONSTANTS:
  gc_title      TYPE lvc_title VALUE 'Maintenance Task List Report',
  gc_suffix_char TYPE string  VALUE ' - Characteristics',
  gc_suffix_ltxt TYPE string  VALUE ' - Long Text'.