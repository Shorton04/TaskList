*&---------------------------------------------------------------------*
*& Include ZRE_A2R_VALID_TASKLIST_TOP
*&---------------------------------------------------------------------*

TABLES: plko, plpo, plmk, tapl, eapl, crhd.

*======================================================================*
* TYPES – BASE DATA (Header + Operation + Characteristic)
*======================================================================*
TYPES: BEGIN OF ty_task_base,

         "------------- Header (5.3.3) -----------------
         plnty     TYPE plko-plnty,
         plnnr     TYPE plko-plnnr,
         plnal     TYPE plko-plnal,
         datuv     TYPE plko-datuv,
         werks     TYPE plko-werks,
         ktext     TYPE plko-ktext,
         verwe     TYPE plko-verwe,
         vagrp     TYPE plko-vagrp,
         stat_h    TYPE plko-statu,
         anlzu_h   TYPE plko-anlzu,
         strat     TYPE plko-strat,
         istru_h   TYPE plko-istru,
         adpsp     TYPE plko-adpsp,
         slwbez    TYPE plko-slwbez,
         loekz_h   TYPE plko-loekz,
         andat     TYPE plko-andat,
         annam     TYPE plko-annam,
         aedat     TYPE plko-aedat,
         aenam     TYPE plko-aenam,

         tplnr     TYPE tapl-tplnr,
         equnr     TYPE eapl-equnr,

         "------------- Operation (5.3.3) --------------
         vornr     TYPE plpo-vornr,
         ltxa1     TYPE plpo-ltxa1,
         steus     TYPE plpo-steus,
         arbpl_o   TYPE crhd-arbpl,
         werks_o   TYPE crhd-werks,        " <-- added op. plant to match so_werop
         ktsch     TYPE plpo-ktsch,
         arbei     TYPE plpo-arbei,
         arbeh     TYPE plpo-arbeh,
         dauno     TYPE plpo-dauno,
         daune     TYPE plpo-daune,
         kalid     TYPE plpo-kalid,
         execution_stage TYPE plpo-execution_stage,
         anlzu_o   TYPE plpo-anlzu,
         istru_o   TYPE plpo-istru,
         larnt     TYPE plpo-larnt,
         ebeln     TYPE plpo-ebeln,
         ebelp     TYPE plpo-ebelp,
         lifnr     TYPE plpo-lifnr,
         preis     TYPE plpo-preis,
         waers     TYPE plpo-waers,
         sakto     TYPE plpo-sakto,
         ekorg     TYPE plpo-ekorg,
         ekgrp     TYPE plpo-ekgrp,
         txtsp_op  TYPE plpo-txtsp,
         loekz_o   TYPE plpo-loekz,

         "------------- Characteristic (5.3.3, 6.x) ----
         merknr      TYPE plmk-merknr,       " Number
         verwmerkm   TYPE plmk-verwmerkm,    " MIC
         kurzt_char  TYPE plmk-kurztext,     " Short text
         ltextkz     TYPE plmk-ltextkz,      " Long text exists
         toleranzun  TYPE plmk-toleranzun,   " Lower limit
         toleranzob  TYPE plmk-toleranzob,   " Upper limit
         pruefeinh   TYPE plmk-pruefeinh,    " Base sample quantity
         stichprver  TYPE plmk-stichprver,   " Sampling procedure
         pmethode    TYPE plmk-pmethode,     " Inspection method (correct)
         katalgart1  TYPE plmk-katalgart1,   " Catalog type
         auswmenge1  TYPE plmk-auswmenge1,   " Code grp / Sel.set
         steuerkz    TYPE plmk-steuerkz,     " Control indicators
         loekz_c     TYPE plmk-loekz,        " Deletion flag (char)

       END OF ty_task_base.

*======================================================================*
* TYPES – DISPLAY (ALV row)
*======================================================================*
TYPES: BEGIN OF ty_task_disp,

         " Header
         plnty     TYPE plko-plnty,
         plnnr     TYPE plko-plnnr,
         plnal     TYPE plko-plnal,
         datuv     TYPE plko-datuv,
         werks     TYPE plko-werks,
         ktext     TYPE plko-ktext,
         tplnr     TYPE tapl-tplnr,
         equnr     TYPE eapl-equnr,
         verwe     TYPE plko-verwe,
         vagrp     TYPE plko-vagrp,
         stat_h    TYPE plko-statu,
         anlzu_h   TYPE plko-anlzu,
         strat     TYPE plko-strat,
         istru_h   TYPE plko-istru,
         adpsp     TYPE plko-adpsp,
         slwbez    TYPE plko-slwbez,
         loekz_h   TYPE plko-loekz,
         andat     TYPE plko-andat,
         annam     TYPE plko-annam,
         aedat     TYPE plko-aedat,
         aenam     TYPE plko-aenam,

         " Operation
         vornr     TYPE plpo-vornr,
         ltxa1     TYPE plpo-ltxa1,
         steus     TYPE plpo-steus,
         arbpl_o   TYPE crhd-arbpl,
         werks_o   TYPE crhd-werks,        " keep in display as well
         ktsch     TYPE plpo-ktsch,
         arbei     TYPE plpo-arbei,
         arbeh     TYPE plpo-arbeh,
         dauno     TYPE plpo-dauno,
         daune     TYPE plpo-daune,
         kalid     TYPE plpo-kalid,
         execution_stage TYPE plpo-execution_stage,
         anlzu_o   TYPE plpo-anlzu,
         istru_o   TYPE plpo-istru,
         larnt     TYPE plpo-larnt,
         ebeln     TYPE plpo-ebeln,
         ebelp     TYPE plpo-ebelp,
         lifnr     TYPE plpo-lifnr,
         preis     TYPE plpo-preis,
         waers     TYPE plpo-waers,
         sakto     TYPE plpo-sakto,
         ekorg     TYPE plpo-ekorg,
         ekgrp     TYPE plpo-ekgrp,
         txtsp_op  TYPE plpo-txtsp,
         loekz_o   TYPE plpo-loekz,

         " Characteristic
         merknr      TYPE plmk-merknr,
         verwmerkm   TYPE plmk-verwmerkm,
         kurzt_char  TYPE plmk-kurztext,
         ltextkz     TYPE plmk-ltextkz,
         toleranzun  TYPE plmk-toleranzun,
         toleranzob  TYPE plmk-toleranzob,
         pruefeinh   TYPE plmk-pruefeinh,
         stichprver  TYPE plmk-stichprver,
         pmethode    TYPE plmk-pmethode,
         katalgart1  TYPE plmk-katalgart1,
         auswmenge1  TYPE plmk-auswmenge1,
         steuerkz    TYPE plmk-steuerkz,
         loekz_c     TYPE plmk-loekz,

         " CI flags (derived from STEUERKZ)
         ci_quant          TYPE c LENGTH 1,
         ci_meas_required  TYPE c LENGTH 1,
         ci_attr_ref       TYPE c LENGTH 1,
         ci_ulim_ind       TYPE c LENGTH 1,
         ci_llim_ind       TYPE c LENGTH 1,
         ci_chk_tgt        TYPE c LENGTH 1,
         ci_scope          TYPE c LENGTH 1,
         ci_single_res     TYPE c LENGTH 1,
         ci_samp_req       TYPE c LENGTH 1,
         ci_recording      TYPE c LENGTH 1,
         ci_doc_req        TYPE c LENGTH 1,
         ci_category       TYPE c LENGTH 1,

         " Long text line
         row_kind   TYPE c LENGTH 1,          " 'O','C','L'
         tdline     TYPE tline-tdline,
         tdformat   TYPE tline-tdformat,

       END OF ty_task_disp.

*======================================================================*
* DATA
*======================================================================*
DATA: gt_base    TYPE STANDARD TABLE OF ty_task_base,
      gs_base    TYPE ty_task_base,
      gt_display TYPE STANDARD TABLE OF ty_task_disp,
      gs_display TYPE ty_task_disp.

DATA: gt_tline TYPE STANDARD TABLE OF tline,
      gs_tline TYPE tline.

*======================================================================*
* SALV
*======================================================================*
DATA: lo_alv        TYPE REF TO cl_salv_table,
      lo_columns    TYPE REF TO cl_salv_columns_table,
      lo_column     TYPE REF TO cl_salv_column_table,
      lo_events     TYPE REF TO cl_salv_events_table,
      lo_funcs      TYPE REF TO cl_salv_functions_list,
      lo_layout     TYPE REF TO cl_salv_layout,
      lo_disp       TYPE REF TO cl_salv_display_settings,
      lo_sel        TYPE REF TO cl_salv_selections,
      ls_layout_key TYPE salv_s_layout_key.

*======================================================================*
* STATE
*======================================================================*
DATA: gv_show_char TYPE abap_bool,
      gv_show_ltxt TYPE abap_bool.

CONSTANTS: gc_true  TYPE abap_bool VALUE abap_true,
           gc_false TYPE abap_bool VALUE abap_false.

" SALV custom function codes (toolbar buttons)
CONSTANTS:
  gc_func_char TYPE salv_de_function VALUE 'ZCHAR',
  gc_func_ltxt TYPE salv_de_function VALUE 'ZLTXT'.