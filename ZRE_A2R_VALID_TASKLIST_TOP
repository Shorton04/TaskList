*---------------------------------------------------------------------*
* Include ZRE_A2R_VALID_TASKLIST_TOP
*---------------------------------------------------------------------*

TABLES: plko, plpo, plmk, tapl, eapl, crhd.

*======================================================================*
* TYPES – BASE DATA
*======================================================================*
TYPES: BEGIN OF ty_task_base,

  " HEADER (PLKO)
  plnty           TYPE plko-plnty,
  plnnr           TYPE plko-plnnr,
  plnal           TYPE plko-plnal,
  datuv           TYPE plko-datuv,
  valid_to        TYPE plko-valid_to,
  werks           TYPE plko-werks,
  ktext           TYPE plko-ktext,
  verwe           TYPE plko-verwe,
  vagrp           TYPE plko-vagrp,
  stat_h          TYPE plko-statu,
  anlzu_h         TYPE plko-anlzu,
  strat           TYPE plko-strat,
  istru_h         TYPE plko-istru,
  adpsp           TYPE plko-adpsp,
  slwbez          TYPE plko-slwbez,
  loekz_h         TYPE plko-loekz,
  andat           TYPE plko-andat,
  annam           TYPE plko-annam,
  aedat           TYPE plko-aedat,
  aenam           TYPE plko-aenam,

  " FLOC/EQUIP
  tplnr           TYPE tapl-tplnr,
  equnr           TYPE eapl-equnr,

  " OPERATIONS (PLPO)
  plnkn           TYPE plpo-plnkn,
  zaehl           TYPE plpo-zaehl,
  datuv_o         TYPE plpo-datuv,
  valid_to_o      TYPE plpo-valid_to,
  vornr           TYPE plpo-vornr,
  ltxa1           TYPE plpo-ltxa1,
  steus           TYPE plpo-steus,
  arbpl_o         TYPE crhd-arbpl,
  werks_o         TYPE crhd-werks,
  ktsch           TYPE plpo-ktsch,
  arbei           TYPE plpo-arbei,
  arbeh           TYPE plpo-arbeh,
  dauno           TYPE plpo-dauno,
  daune           TYPE plpo-daune,
  kalid           TYPE plpo-kalid,
  execution_stage TYPE plpo-execution_stage,
  anlzu_o         TYPE plpo-anlzu,
  istru_o         TYPE plpo-istru,
  larnt           TYPE plpo-larnt,
  ebeln           TYPE plpo-ebeln,
  ebelp           TYPE plpo-ebelp,
  lifnr           TYPE plpo-lifnr,
  preis           TYPE plpo-preis,
  waers           TYPE plpo-waers,
  sakto           TYPE plpo-sakto,
  ekorg           TYPE plpo-ekorg,
  ekgrp           TYPE plpo-ekgrp,
  txtsp_op        TYPE plpo-txtsp,
  loekz_o         TYPE plpo-loekz,

  " CHARACTERISTICS (PLMK)
  merknr          TYPE plmk-merknr,
  verwmerkm       TYPE plmk-verwmerkm,
  kurzt_char      TYPE plmk-kurztext,
  ltextkz         TYPE plmk-ltextkz,
  toleranzun      TYPE plmk-toleranzun,
  toleranzob      TYPE plmk-toleranzob,
  pruefeinh       TYPE plmk-pruefeinh,
  stichprver      TYPE plmk-stichprver,
  pmethode        TYPE plmk-pmethode,
  katalgart1      TYPE plmk-katalgart1,
  auswmenge1      TYPE plmk-auswmenge1,
  steuerkz        TYPE plmk-steuerkz,
  loekz_c         TYPE plmk-loekz,
  gueltigab       TYPE plmk-gueltigab,
  valid_to_c      TYPE plmk-valid_to_on_db,

END OF ty_task_base.

*======================================================================*
* TYPES – DISPLAY
*======================================================================*
TYPES: BEGIN OF ty_task_disp,

  " HEADER
  plnty           TYPE plko-plnty,
  plnnr           TYPE plko-plnnr,
  plnal           TYPE plko-plnal,
  datuv           TYPE plko-datuv,
  werks           TYPE plko-werks,
  ktext           TYPE plko-ktext,
  tplnr           TYPE tapl-tplnr,
  equnr           TYPE eapl-equnr,
  verwe           TYPE plko-verwe,
  vagrp           TYPE plko-vagrp,
  stat_h          TYPE plko-statu,
  anlzu_h         TYPE plko-anlzu,
  strat           TYPE plko-strat,
  istru_h         TYPE plko-istru,
  adpsp           TYPE plko-adpsp,
  slwbez          TYPE plko-slwbez,
  loekz_h         TYPE plko-loekz,
  andat           TYPE plko-andat,
  annam           TYPE plko-annam,
  aedat           TYPE plko-aedat,
  aenam           TYPE plko-aenam,

  " OPERATIONS
  vornr           TYPE plpo-vornr,
  ltxa1           TYPE plpo-ltxa1,
  steus           TYPE plpo-steus,
  arbpl_o         TYPE crhd-arbpl,
  werks_o         TYPE crhd-werks,
  ktsch           TYPE plpo-ktsch,
  arbei           TYPE plpo-arbei,
  arbeh           TYPE plpo-arbeh,
  dauno           TYPE plpo-dauno,
  daune           TYPE plpo-daune,
  kalid           TYPE plpo-kalid,
  execution_stage TYPE plpo-execution_stage,
  anlzu_o         TYPE plpo-anlzu,
  istru_o         TYPE plpo-istru,
  larnt           TYPE plpo-larnt,
  ebeln           TYPE plpo-ebeln,
  ebelp           TYPE plpo-ebelp,
  lifnr           TYPE plpo-lifnr,
  preis           TYPE plpo-preis,
  waers           TYPE plpo-waers,
  sakto           TYPE plpo-sakto,
  ekorg           TYPE plpo-ekorg,
  ekgrp           TYPE plpo-ekgrp,
  txtsp_op        TYPE plpo-txtsp,
  loekz_o         TYPE plpo-loekz,

  " CHARACTERISTICS
  merknr          TYPE plmk-merknr,
  verwmerkm       TYPE plmk-verwmerkm,
  kurzt_char      TYPE plmk-kurztext,
  ltextkz         TYPE plmk-ltextkz,
  toleranzun      TYPE plmk-toleranzun,
  toleranzob      TYPE plmk-toleranzob,
  pruefeinh       TYPE plmk-pruefeinh,
  stichprver      TYPE plmk-stichprver,
  pmethode        TYPE plmk-pmethode,
  katalgart1      TYPE plmk-katalgart1,
  auswmenge1      TYPE plmk-auswmenge1,
  steuerkz        TYPE plmk-steuerkz,
  loekz_c         TYPE plmk-loekz,

  " CI FIELDS 1–28
  ci1 TYPE c LENGTH 1,
  ci2 TYPE c LENGTH 1,
  ci3 TYPE c LENGTH 1,
  ci4 TYPE c LENGTH 1,
  ci5 TYPE c LENGTH 1,
  ci6 TYPE c LENGTH 1,
  ci7 TYPE c LENGTH 1,
  ci8 TYPE c LENGTH 1,
  ci9 TYPE c LENGTH 1,
  ci10 TYPE c LENGTH 1,
  ci11 TYPE c LENGTH 1,
  ci12 TYPE c LENGTH 1,
  ci13 TYPE c LENGTH 1,
  ci14 TYPE c LENGTH 1,
  ci15 TYPE c LENGTH 1,
  ci16 TYPE c LENGTH 1,
  ci17 TYPE c LENGTH 1,
  ci18 TYPE c LENGTH 1,
  ci19 TYPE c LENGTH 1,
  ci20 TYPE c LENGTH 1,
  ci21 TYPE c LENGTH 1,
  ci22 TYPE c LENGTH 1,
  ci23 TYPE c LENGTH 1,
  ci24 TYPE c LENGTH 1,
  ci25 TYPE c LENGTH 1,
  ci26 TYPE c LENGTH 1,
  ci27 TYPE c LENGTH 1,
  ci28 TYPE c LENGTH 1,

  " LONG TEXT
  row_kind TYPE c LENGTH 1,
  tdformat TYPE tline-tdformat,
  op_ltxt  TYPE tline-tdline,
  char_ltxt TYPE tline-tdline,

END OF ty_task_disp.

*---------------------------------------------------------------------*
* DATA DECLARATIONS
*---------------------------------------------------------------------*
DATA: gt_base     TYPE STANDARD TABLE OF ty_task_base,
      gs_base     TYPE ty_task_base,
      gt_display  TYPE STANDARD TABLE OF ty_task_disp,
      gs_display  TYPE ty_task_disp.

DATA: lo_alv      TYPE REF TO cl_salv_table,
      lo_columns  TYPE REF TO cl_salv_columns_table,
      lo_column   TYPE REF TO cl_salv_column_table,
      lo_events   TYPE REF TO cl_salv_events_table,
      lo_funcs    TYPE REF TO cl_salv_functions_list,
      lo_layout   TYPE REF TO cl_salv_layout.

DATA: gv_show_char TYPE abap_bool,
      gv_show_ltxt TYPE abap_bool.

CONSTANTS: gc_true  TYPE abap_bool VALUE abap_true,
           gc_false TYPE abap_bool VALUE abap_false.

*---------------------------------------------------------------------*
* EVENT HANDLER CLASS
*---------------------------------------------------------------------*
CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
    CLASS-METHODS on_user_command
      FOR EVENT added_function OF cl_salv_events_table
      IMPORTING e_salv_function.
ENDCLASS.