*---------------------------------------------------------------------*
* PF-STATUS determination (Maintplan-style)
*---------------------------------------------------------------------*
FORM set_pfstatus_from_state.

  DATA lv_pf TYPE sypfkey.

  " Decide which PF-STATUS to use
  IF gv_show_char = gc_false AND gv_show_ltxt = gc_false.
    lv_pf = 'ZSALV_BOTH_HIDE'.
  ELSEIF gv_show_char = gc_false AND gv_show_ltxt = gc_true.
    lv_pf = 'ZSALV_LTXT_SHOW'.
  ELSE.
    " Characteristics mode (with or without long text)
    lv_pf = 'ZSALV_CLIST_SHOW'.
  ENDIF.

  " Apply to SALV
  IF lo_alv IS BOUND.
    lo_alv->set_screen_status(
      pfstatus = lv_pf
      report   = sy-repid ).
      " no SET_FUNCTIONS here – avoids the type error
  ENDIF.

ENDFORM.




        "-----------------------------------------------------------*
        " Column texts – FDS-friendly captions (<= 10 chars for short)
        "-----------------------------------------------------------*
        TRY.
            lo_column ?= lo_columns->get_column( 'PLNNR' ).
            lo_column->set_short_text(  'Group' ).
            lo_column->set_medium_text( 'Group' ).
            lo_column->set_long_text(   'Group' ).
          CATCH cx_salv_not_found.
        ENDTRY.

        TRY.
            lo_column ?= lo_columns->get_column( 'PLNAL' ).
            lo_column->set_short_text(  'Counter' ).
            lo_column->set_medium_text( 'Counter' ).
            lo_column->set_long_text(   'Counter' ).
          CATCH cx_salv_not_found.
        ENDTRY.

        TRY.
            lo_column ?= lo_columns->get_column( 'WERKS' ).
            lo_column->set_short_text(  'Plant' ).
            lo_column->set_medium_text( 'Plant' ).
            lo_column->set_long_text(   'Plant' ).
          CATCH cx_salv_not_found.
        ENDTRY.

        TRY.
            lo_column ?= lo_columns->get_column( 'VORNR' ).
            lo_column->set_short_text(  'Operation' ).
            lo_column->set_medium_text( 'Operation' ).
            lo_column->set_long_text(   'Operation' ).
          CATCH cx_salv_not_found.
        ENDTRY.

        TRY.
            lo_column ?= lo_columns->get_column( 'OP_LTXT' ).
            lo_column->set_short_text(  'Op LTxt' ).
            lo_column->set_medium_text( 'Op Long Text' ).
            lo_column->set_long_text(   'Op Long Text' ).
          CATCH cx_salv_not_found.
        ENDTRY.

        TRY.
            lo_column ?= lo_columns->get_column( 'ARBPL_O' ).
            lo_column->set_short_text(  'Work Ctr' ).
            lo_column->set_medium_text( 'Work Center' ).
            lo_column->set_long_text(   'Work Center' ).
          CATCH cx_salv_not_found.
        ENDTRY.

        TRY.
            lo_column ?= lo_columns->get_column( 'ARBEI' ).
            lo_column->set_short_text(  'Work' ).
            lo_column->set_medium_text( 'Work' ).
            lo_column->set_long_text(   'Work' ).
          CATCH cx_salv_not_found.
        ENDTRY.

        TRY.
            lo_column ?= lo_columns->get_column( 'KURZT_CHAR' ).
            lo_column->set_short_text(  'Insp Desc' ).
            lo_column->set_medium_text( 'Insp. Description' ).
            lo_column->set_long_text(   'Insp. Description' ).
          CATCH cx_salv_not_found.
        ENDTRY.

        TRY.
            lo_column ?= lo_columns->get_column( 'PMETHODE' ).
            lo_column->set_short_text(  'Insp Meth' ).
            lo_column->set_medium_text( 'Insp. Method' ).
            lo_column->set_long_text(   'Insp. Method' ).
          CATCH cx_salv_not_found.
        ENDTRY.

        TRY.
            lo_column ?= lo_columns->get_column( 'CHAR_LTXT' ).
            lo_column->set_short_text(  'Char LTxt' ).
            lo_column->set_medium_text( 'Char Long Text' ).
            lo_column->set_long_text(   'Char Long Text' ).
          CATCH cx_salv_not_found.
        ENDTRY.