*---------------------------------------------------------------------*
*  FORM display_alv
*---------------------------------------------------------------------*
FORM display_alv.

  DATA: ls_layout   TYPE slis_layout_alv,
        lt_sort     TYPE slis_t_sortinfo_alv,
        ls_sort     TYPE slis_sortinfo_alv.

  "--------------------------------------------------------------
  " PROTECT: If no display data, exit gracefully
  "--------------------------------------------------------------
  IF gt_display IS INITIAL.
    MESSAGE 'No Data found' TYPE 'S'.
    RETURN.
  ENDIF.

  "--------------------------------------------------------------
  " PROTECT: If fieldcat empty â†’ this causes your error
  "--------------------------------------------------------------
  IF gt_fieldcat IS INITIAL.
    MESSAGE 'Field catalog not built' TYPE 'E'.
    RETURN.
  ENDIF.

  "--------------------------------------------------------------
  " Layout Settings
  "--------------------------------------------------------------
  CLEAR ls_layout.
  ls_layout-zebra       = abap_true.
  ls_layout-colwidth_optimize = abap_true.
  ls_layout-detail_popup = abap_true.

  "--------------------------------------------------------------
  " Sort by Group / Counter / Operation
  "--------------------------------------------------------------
  CLEAR ls_sort.
  ls_sort-fieldname = 'PLNNR'.
  ls_sort-up        = 'X'.
  APPEND ls_sort TO lt_sort.

  CLEAR ls_sort.
  ls_sort-fieldname = 'PLNAL'.
  ls_sort-up        = 'X'.
  APPEND ls_sort TO lt_sort.

  CLEAR ls_sort.
  ls_sort-fieldname = 'VORNR'.
  ls_sort-up        = 'X'.
  APPEND ls_sort TO lt_sort.

  "--------------------------------------------------------------
  " Display ALV
  "--------------------------------------------------------------
  CALL FUNCTION 'REUSE_ALV_GRID_DISPLAY'
    EXPORTING
      i_callback_program     = sy-repid
      is_layout              = ls_layout
      it_fieldcat            = gt_fieldcat
      it_sort                = lt_sort
    TABLES
      t_outtab               = gt_display
    EXCEPTIONS
      program_error          = 1
      OTHERS                 = 2.

  IF sy-subrc <> 0.
    MESSAGE ID sy-msgid TYPE sy-msgty NUMBER sy-msgno
            WITH sy-msgv1 sy-msgv2 sy-msgv3 sy-msgv4.
  ENDIF.

ENDFORM.