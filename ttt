INTO TABLE @DATA(lt_raw).

  LOOP AT lt_raw ASSIGNING FIELD-SYMBOL(<l>).

    CLEAR gs_display.

    MOVE-CORRESPONDING <l> TO gs_display.

    "--- Map STEUERKZ bits â†’ CI01..CI28 dynamically
    DO 28 TIMES.
      DATA(lv_idx) = sy-index.
      DATA(lv_field) = |CI{ lv_idx ALPHA = OUT }|.
      ASSIGN COMPONENT lv_field OF STRUCTURE gs_display TO FIELD-SYMBOL(<f>).
      IF <f> IS ASSIGNED.
        IF <l>-steuerkz+lv_idx(1) = 'X'.
          <f> = 'X'.
        ENDIF.
      ENDIF.
    ENDDO.

    APPEND gs_display TO gt_display.

  ENDLOOP.




FORM build_display.

  TRY.
      cl_salv_table=>factory(
        IMPORTING r_salv_table = go_alv
        CHANGING  t_table      = gt_display ).

    CATCH cx_salv_msg INTO DATA(lx).
      MESSAGE lx->get_text( ) TYPE 'E'.
  ENDTRY.

  go_columns = go_alv->get_columns( ).

  " Apply FDS visibility rules
  PERFORM set_column_visibility_by_state.

  go_alv->display( ).

ENDFORM.





FORM set_column_visibility_by_state.

  DATA(lo_col) TYPE REF TO cl_salv_column_table.

  "--- 1. Hide all CI columns --------------------------
  DO 28 TIMES.
    DATA(lv_idx) = sy-index.
    DATA(lv_name) = |CI{ lv_idx ALPHA = OUT }|.
    TRANSLATE lv_name TO UPPER CASE.

    TRY.
        lo_col ?= go_columns->get_column( lv_name ).
        lo_col->set_visible( if_salv_c_bool_sap=>false ).
      CATCH cx_salv_not_found.
    ENDTRY.
  ENDDO.

  "--- 2. FDS mandatory visible columns ----------------
  DATA lt_show TYPE STANDARD TABLE OF string WITH EMPTY KEY.

  APPEND 'PLNNR'   TO lt_show.
  APPEND 'PLNAL'   TO lt_show.
  APPEND 'WERKS'   TO lt_show.
  APPEND 'VORNR'   TO lt_show.
  APPEND 'ARBPL_O' TO lt_show.
  APPEND 'ARBEI'   TO lt_show.

  LOOP AT lt_show INTO DATA(lv_colname).
    TRY.
        lo_col ?= go_columns->get_column( lv_colname ).
        lo_col->set_visible( if_salv_c_bool_sap=>true ).
      CATCH cx_salv_not_found.
    ENDTRY.
  ENDLOOP.

ENDFORM.